(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{406:function(t,s,e){"use strict";e.r(s);var a=e(56),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[t._v("#")]),t._v(" Deployment")]),t._v(" "),e("p",[t._v("The Skeleton comes with a GitHub Actions workflow which builds & pushes to AWS ECR.")]),t._v(" "),e("h2",{attrs:{id:"github-secrets"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#github-secrets"}},[t._v("#")]),t._v(" GitHub Secrets")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("AWS_ACCESS_KEY")])]),t._v(" "),e("li",[e("code",[t._v("AWS_SECRET_ACCESS_KEY")])]),t._v(" "),e("li",[e("code",[t._v("AWS_REGION")])])]),t._v(" "),e("h2",{attrs:{id:"setup-aws-ecr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-aws-ecr"}},[t._v("#")]),t._v(" Setup AWS ECR")]),t._v(" "),e("p",[t._v("You need to create a new repository for each container role ("),e("code",[t._v("web")]),t._v(", "),e("code",[t._v("queue")]),t._v(" and "),e("code",[t._v("scheduler")]),t._v(") with the format of "),e("code",[t._v("<name>/<role>")]),t._v(". The name can be configured via the "),e("code",[t._v("REPOSITORY_PREFIX")]),t._v(" value in the "),e("a",{attrs:{href:"/.github/workflows/deploy.yml"}},[t._v("Deploy GitHub Actions workflow")]),t._v(".")]),t._v(" "),e("p",[t._v("Example:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("skeleton/web")])]),t._v(" "),e("li",[e("code",[t._v("skeleton/queue")])]),t._v(" "),e("li",[e("code",[t._v("skeleton/scheduler")])])]),t._v(" "),e("h3",{attrs:{id:"aws-credentials"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aws-credentials"}},[t._v("#")]),t._v(" ~/.aws/credentials")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[<PROFILE>]\naws_access_key_id=***\naws_secret_access_key=***\n")])])]),e("h3",{attrs:{id:"aws-config"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aws-config"}},[t._v("#")]),t._v(" ~/.aws/config")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[profile <PROFILE>]\nregion=<REGION>\n")])])]),e("h3",{attrs:{id:"authenticate-for-docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authenticate-for-docker"}},[t._v("#")]),t._v(" Authenticate for Docker")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("aws ecr get-login-password --profile <PROFILE> | docker login --username AWS --password-stdin <URL>\n")])])]),e("ul",[e("li",[t._v("Replace (or remove) "),e("code",[t._v("<PROFILE>")])]),t._v(" "),e("li",[t._v("Replace "),e("code",[t._v("<URL>")]),t._v(" with your ECR URL ("),e("code",[t._v("<ID>.dkr.ecr.<REGION>.amazonaws.com")]),t._v(")")])]),t._v(" "),e("p",[t._v("If you get a "),e("code",[t._v("Error response from daemon: login attempt to ... failed with status: 400 Bad Request")]),t._v(" you propably entered the wrong region.")]),t._v(" "),e("h2",{attrs:{id:"directory-structure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#directory-structure"}},[t._v("#")]),t._v(" Directory structure")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(".\n├── database             Persistent database storage\n├── docker-compose.yml\n├── .env                 Environment values for docker-compose\n├── storage              Laravel storage\n│   ├── app              Laravel storage\n│   └── logs             Laravel storage\n└── web\n    ├── app.conf         web Container nginx site\n    └── .env             Laravel .env file\n")])])]),e("h2",{attrs:{id:"host-nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#host-nginx"}},[t._v("#")]),t._v(" Host nginx")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  <server_name>")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v("            <cert.crt>")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v("        <cert.key>")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_protocols")]),t._v("              TLSv1 TLSv1.1 TLSv1.2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_ciphers")]),t._v("                "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AES128+EECDH:AES128+EDH'")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_prefer_server_ciphers")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v("        http://localhost:8000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# <----------")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  Host "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  X-Real-IP "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  X-Forwarded-For "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  X-Forwarded-Proto "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /favicon.ico")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v("     "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_not_found")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /robots.txt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v("     "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_not_found")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /\\.ht")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("deny")]),t._v(" all")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);